<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
</head>
<body>
<p><strong>github.ioのサーバー時刻:</strong> <span id="server"></span></p>
<p><strong>端末の時刻:</strong> <span id="client"></span></p>
<p><strong>時差:</strong> <span id="dif"></span></p>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
<script>
/*
var x_timer = 'S1602674787.604632,VS0,VE180';
x_timer = parseInt(x_timer.split(',')[0].replace(/[^0-9|.]/g,'')) * 1000;
var a = new Date(x_timer);
console.log(a);
*/
function getServerDate(callback){
	$.ajax({
		type : 'HEAD',
		url :  window.location.href,
		cache : false
	}).done(function(data, textStatus, xhr) {
		try {
			var xTimer = xhr.getResponseHeader("X-Timer");
			xTimer = parseFloat(xTimer.split(',')[0].replace(/[^0-9|.]/g,''));
			var milli = parseInt(String(xTimer).split('.')[1] || 0);
			if (milli >= 5) {
				xTimer -= 1;
			}
			xTimer = xTimer * 1000;
			var result = new Date(xTimer);
			result = result.getHours() + ':' + result.getMinutes() + ':' + result.getSeconds() + '.' + result.getMilliseconds();
			var now = new Date();
			var dif = now.getTime() - xTimer;
			var str;
			if (dif) {
				str = 'あなたの端末は ' + Math.abs((dif / 1000)).toFixed(2) + ' 秒進んでいます。';
			} else {
				str = 'あなたの端末は ' + Math.abs((dif / 1000)).toFixed(2) + ' 秒進んでいます。';
			}
			$("#dif").text(str);
		} catch(e) {
			var result = new Date();
			result = result.getHours() + ':' + result.getMinutes() + ':' + result.getSeconds() + '.' + result.getMilliseconds();
		}
		callback(result);
	}).fail(function() {
		var result = new Date();
		result = result.getHours() + ':' + result.getMinutes() + ':' + result.getSeconds() + '.' + result.getMilliseconds();
		callback(result);
	});
}

function makeHTML(result){
	$("#server").html(result);
}

getServerDate(makeHTML);

var clientDate = new Date();
clientDate = clientDate.getHours() + ':' + clientDate.getMinutes() + ':' + clientDate.getSeconds() + '.' + clientDate.getMilliseconds();
$("#client").html(clientDate);
</script>
</body>
</html>